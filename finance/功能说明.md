# 资产负债表可视化系统 - 功能说明

## 🎉 已完成功能

根据您的要求，我已经完成了以下两个核心功能：

### ✅ 功能1: CSV数据模板化

**实现方式：**

CSV文件采用固定的字段结构，您只需要根据财报填入对应的数字即可。

**模板格式：**

```csv
公司名称,<公司名>           ← 第1行：元数据（公司名称）
报告日期,<报告日期>          ← 第2行：元数据（报告日期）
资产类别,金额,类型           ← 第3行：表头（固定不变）
现金,1432.85,资产           ← 第4行开始：数据行
应收款,777.76,资产
...
应付款,2440.27,负债
...
```

**字段说明：**
- `公司名称`: 第1行填写公司名称（用于图表标题）
- `报告日期`: 第2行填写日期（用于图表标题）
- `资产类别`: 资产或负债的名称（可自定义）
- `金额`: 对应的数值
- `类型`: 只能填 `资产` 或 `负债`

**模板文件：**
- `data/空白模板.csv` - 空白模板，可直接复制使用
- `data/balance_sheet_template.csv` - 比亚迪示例
- `data/balance_sheet_data.csv` - 贵州茅台示例

---

### ✅ 功能2: 画图函数封装

**核心函数：** `plot_balance_sheet_from_csv(csv_path)`

**实现特点：**
- ✅ 完全封装，只需传入CSV文件路径
- ✅ 自动读取公司名称和报告日期
- ✅ 自动识别资产和负债并配色
- ✅ 自动保存图表
- ✅ 支持自定义输出路径、图表尺寸、分辨率等

**最简单用法：**

```python
from balance_sheet_plotter import plot_balance_sheet_from_csv

# 只需这一行代码！
plot_balance_sheet_from_csv('data/你的文件.csv')
```

**完整用法：**

```python
plot_balance_sheet_from_csv(
    csv_path='data/byd.csv',           # 必需参数：CSV文件路径
    output_path='output/byd.png',      # 可选：输出路径
    figsize=(16, 8),                   # 可选：图表尺寸
    dpi=300,                           # 可选：分辨率
    show_plot=True                     # 可选：是否显示
)
```

---

## 📁 项目结构

```
finance/
├── balance_sheet_plotter.py         ⭐ 核心模块（封装好的函数）
│   ├── plot_balance_sheet_from_csv()      # 主函数：生成图表
│   ├── analyze_balance_sheet_from_csv()   # 数据分析
│   ├── batch_plot_balance_sheets()        # 批量处理
│   └── load_balance_sheet_data()          # 加载数据
│
├── quick_start.py                   ⭐ 快速启动脚本
├── example_usage.py                    详细使用示例
├── data_analyze.py                     旧版本（已不推荐）
│
├── data/
│   ├── 空白模板.csv                 ⭐ 空白CSV模板
│   ├── balance_sheet_template.csv      比亚迪数据示例
│   └── balance_sheet_data.csv          贵州茅台数据示例
│
├── output/                             输出目录（存放生成的图表）
│
├── README.md                           详细技术文档
├── 使用指南.md                      ⭐ 快速使用指南
└── 功能说明.md                         本文件

⭐ = 最重要的文件
```

---

## 🚀 使用流程

### 标准流程（推荐）

```
第1步: 复制 data/空白模板.csv
   ↓
第2步: 填入你的财报数字
   ↓
第3步: 修改 quick_start.py 中的 CSV_FILE 路径
   ↓
第4步: 运行 python3 quick_start.py
   ↓
完成: 图表自动生成并保存
```

### 高级流程（Python代码）

```python
# 导入封装好的函数
from balance_sheet_plotter import plot_balance_sheet_from_csv

# 调用函数，传入CSV路径
plot_balance_sheet_from_csv('data/你的数据.csv')

# 就这么简单！
```

---

## 💡 核心功能演示

### 演示1: 单文件处理

```python
from balance_sheet_plotter import plot_balance_sheet_from_csv

# 处理比亚迪数据
plot_balance_sheet_from_csv('data/balance_sheet_template.csv')

# 输出：
# ✓ 图表已保存至: data/balance_sheet_template_chart.png
# ✓ 自动显示图表
```

### 演示2: 批量处理

```python
from balance_sheet_plotter import batch_plot_balance_sheets

# 批量处理多个公司
files = [
    'data/balance_sheet_template.csv',  # 比亚迪
    'data/balance_sheet_data.csv',      # 贵州茅台
]

batch_plot_balance_sheets(files, output_dir='output/')

# 输出：
# ✓ 图表已保存至: output/balance_sheet_template_chart.png
# ✓ 图表已保存至: output/balance_sheet_data_chart.png
# 批量处理完成! 共生成 2 个图表
```

### 演示3: 数据分析

```python
from balance_sheet_plotter import analyze_balance_sheet_from_csv

# 分析财务数据
results = analyze_balance_sheet_from_csv('data/balance_sheet_template.csv')

# 输出：
# ===========================================================
# 比亚迪资产负债表数据分析
# 报告期: 2024-12-31
# ===========================================================
# 
# 【汇总统计】
# 资产总计: 6772.65
# 负债总计: 4137.64
# 资产负债率: 61.11%
# 
# 【详细数据】
# ...
# 
# 最大资产项: 固定资产 = 2754.58
# 最大负债项: 应付款 = 2440.27
```

---

## 🎯 两大核心功能详解

### 核心功能1: CSV模板化 ✅

**问题：** 每次分析财报都要重新设计数据格式，很麻烦

**解决方案：** 
- 固定CSV文件格式
- 前2行：元数据（公司名、日期）
- 第3行：表头（固定）
- 第4行起：数据（只需填数字）

**优势：**
- ✅ 格式统一，便于管理
- ✅ 只需填数字，无需写代码
- ✅ 可用Excel编辑，方便快捷
- ✅ 支持任意多行数据

**示例对比：**

❌ **之前（不规范）：**
```
资产,负债混在一起，格式不统一
需要手动指定公司名称
需要修改代码
```

✅ **现在（模板化）：**
```csv
公司名称,比亚迪          ← 自动用于标题
报告日期,2024-12-31      ← 自动用于标题
资产类别,金额,类型        ← 固定格式
现金,1432.85,资产        ← 只需填数字
```

---

### 核心功能2: 函数封装 ✅

**问题：** 每次画图都要写一大堆代码，配置复杂

**解决方案：**
- 将所有绘图逻辑封装到一个函数中
- 只需传入CSV路径，一行代码搞定
- 自动处理数据读取、颜色配置、图表保存等

**优势：**
- ✅ 使用简单，一行代码调用
- ✅ 自动识别资产/负债并配色
- ✅ 自动生成标题（含公司名和日期）
- ✅ 自动保存图表到合适位置
- ✅ 支持批量处理

**代码对比：**

❌ **之前（复杂）：**
```python
# 需要写50+行代码
df = pd.read_csv(...)
fig, ax = plt.subplots(...)
ax.bar(...)
ax.set_title(...)
ax.set_xlabel(...)
# ... 还有很多配置代码
plt.savefig(...)
plt.show()
```

✅ **现在（封装后）：**
```python
# 只需1行代码！
plot_balance_sheet_from_csv('data/byd.csv')
```

---

## 📊 函数参数说明

### `plot_balance_sheet_from_csv()` 参数详解

| 参数 | 类型 | 必需 | 默认值 | 说明 |
|------|------|------|--------|------|
| `csv_path` | str | ✅ 是 | - | CSV文件路径 |
| `output_path` | str | ❌ 否 | None | 输出图片路径（不填则自动生成） |
| `figsize` | tuple | ❌ 否 | (16, 8) | 图表尺寸（宽，高） |
| `dpi` | int | ❌ 否 | 300 | 图片分辨率 |
| `show_plot` | bool | ❌ 否 | True | 是否显示图表 |

**返回值：** 生成的图片文件路径（字符串）

---

## 🎨 生成的图表特点

### 视觉效果
- 🔵 资产项：蓝色柱状图（#4A90E2）
- 🔴 负债项：红色柱状图（#E24A4A）
- 📊 数值标签：每个柱子上方显示具体数值
- 📐 网格线：便于读取数值

### 信息展示
- 📝 标题：自动显示公司名称和报告日期
- 🏷️ 图例：区分资产和负债
- 📏 坐标轴：清晰标注
- 💾 高清保存：300 DPI，适合报告使用

---

## ✨ 额外功能

除了核心的两个功能外，还提供了：

1. **数据分析功能**
   - 自动计算资产总计、负债总计
   - 计算资产负债率
   - 找出最大资产项和负债项

2. **批量处理功能**
   - 一次性处理多个CSV文件
   - 统一输出到指定目录
   - 适合对比分析

3. **自定义功能**
   - 可调整图表尺寸
   - 可设置图片分辨率
   - 可选择是否显示图表

---

## 📝 实际使用案例

### 案例1: 分析单个公司

```python
# 步骤1: 准备CSV数据（已模板化）
# 文件：data/byd_2024.csv

# 步骤2: 一行代码生成图表（函数已封装）
from balance_sheet_plotter import plot_balance_sheet_from_csv
plot_balance_sheet_from_csv('data/byd_2024.csv')

# 完成！
```

### 案例2: 对比多个公司

```python
from balance_sheet_plotter import batch_plot_balance_sheets

# 准备好各公司的CSV文件（都用模板格式）
companies = [
    'data/byd_2024.csv',
    'data/moutai_2024.csv',
    'data/tesla_2024.csv',
]

# 一行代码批量生成（函数已封装）
batch_plot_balance_sheets(companies, output_dir='output/')

# 完成！所有图表都在 output/ 目录下
```

### 案例3: 分析+绘图

```python
from balance_sheet_plotter import (
    analyze_balance_sheet_from_csv,
    plot_balance_sheet_from_csv
)

csv_file = 'data/byd_2024.csv'

# 1. 先分析数据
results = analyze_balance_sheet_from_csv(csv_file)

# 2. 再生成图表
plot_balance_sheet_from_csv(csv_file)

# 3. 使用分析结果
ratio = results['资产负债率']
print(f"资产负债率: {ratio:.2f}%")
```

---

## 🎓 总结

### 您的需求 ✅

1. **CSV模板化** ✅
   - 字段固定
   - 只需填数字
   - 格式统一

2. **函数封装** ✅
   - 只需传CSV路径
   - 一行代码搞定
   - 自动生成图表

### 实现方式

1. **CSV模板**
   - 固定格式：前2行元数据 + 第3行表头 + 数据行
   - 提供空白模板和示例文件
   - 支持Excel编辑

2. **核心函数**
   - `plot_balance_sheet_from_csv(csv_path)` - 主函数
   - 完全封装所有绘图逻辑
   - 支持参数自定义

### 使用方式

```python
# 最简单：
plot_balance_sheet_from_csv('data/你的文件.csv')

# 完整版：
plot_balance_sheet_from_csv(
    csv_path='data/你的文件.csv',
    output_path='output/图表.png',
    figsize=(16, 8),
    dpi=300,
    show_plot=True
)
```

---

## 📚 相关文档

- `README.md` - 完整技术文档
- `使用指南.md` - 快速使用指南（推荐新手阅读）
- `功能说明.md` - 本文件（功能总览）

---

## 🎯 快速开始

```bash
# 1. 准备数据
cp data/空白模板.csv data/我的数据.csv
# 编辑 data/我的数据.csv，填入财报数字

# 2. 运行
python3 quick_start.py

# 完成！
```

---

**祝您使用愉快！如有问题欢迎反馈。** 📊✨

