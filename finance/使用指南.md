# 资产负债表可视化系统 - 使用指南

## 🎯 核心功能

✅ **CSV数据模板化** - 字段固定，只需填数字  
✅ **函数封装化** - 只传CSV路径即可生成图表  
✅ **一键生成图表** - 无需复杂配置

---

## 📦 安装依赖

在使用前，请先安装必要的Python包：

```bash
pip install pandas matplotlib numpy
```

或者使用项目根目录的 requirements.txt:

```bash
cd /Users/chuhaonan/Desktop/code/pyProject/myproject
pip install -r requirements.txt
```

---

## 🚀 三步使用流程

### 第一步：准备CSV数据文件

1. **复制空白模板**
   ```bash
   cp data/空白模板.csv data/我的公司.csv
   ```

2. **填入财报数据**
   
   打开 `data/我的公司.csv`，按照以下格式填入数据：

   ```csv
   公司名称,比亚迪
   报告日期,2024-12-31
   资产类别,金额,类型
   现金,1432.85,资产
   应收款,777.76,资产
   预付款,39.74,资产
   存货,1160.36,资产
   ...
   应付款,2440.27,负债
   ...
   ```

   **重要规则：**
   - ✅ 第1行：`公司名称,公司名`
   - ✅ 第2行：`报告日期,YYYY-MM-DD`
   - ✅ 第3行：表头（不要改）
   - ✅ 第4行开始：数据（格式：资产类别,金额,类型）
   - ✅ 类型只能是"资产"或"负债"

### 第二步：修改快速启动脚本

打开 `quick_start.py`，修改CSV文件路径：

```python
# 只需修改这一行！
CSV_FILE = 'data/我的公司.csv'
```

### 第三步：运行脚本生成图表

```bash
cd /Users/chuhaonan/Desktop/code/pyProject/myproject/finance
python3 quick_start.py
```

就这么简单！图表会自动生成并保存。

---

## 💡 核心函数使用

### 方法1：最简单的用法（推荐）

```python
from balance_sheet_plotter import plot_balance_sheet_from_csv

# 只需要这一行代码！
plot_balance_sheet_from_csv('data/byd.csv')
```

**输出：**
- 自动显示图表
- 自动保存为 `data/byd_chart.png`

---

### 方法2：自定义输出路径

```python
from balance_sheet_plotter import plot_balance_sheet_from_csv

# 指定保存位置
plot_balance_sheet_from_csv(
    csv_path='data/byd.csv',
    output_path='output/比亚迪_2024年报.png'
)
```

---

### 方法3：批量处理多个公司

```python
from balance_sheet_plotter import batch_plot_balance_sheets

# 准备多个CSV文件
files = [
    'data/byd_2024.csv',
    'data/moutai_2024.csv',
    'data/tesla_2024.csv'
]

# 一键批量生成
batch_plot_balance_sheets(files, output_dir='output/')
```

---

### 方法4：数据分析

```python
from balance_sheet_plotter import analyze_balance_sheet_from_csv

# 分析财务数据
results = analyze_balance_sheet_from_csv('data/byd.csv')

# 查看分析结果
print(f"资产负债率: {results['资产负债率']:.2f}%")
```

---

## 📊 CSV模板详解

### 标准格式

```csv
公司名称,<填写公司名称>
报告日期,<填写日期 YYYY-MM-DD>
资产类别,金额,类型
<资产项1>,<金额>,资产
<资产项2>,<金额>,资产
...
<负债项1>,<金额>,负债
<负债项2>,<金额>,负债
...
```

### 字段说明

| 行号 | 内容 | 说明 | 示例 |
|------|------|------|------|
| 第1行 | 公司名称 | 元数据，用于图表标题 | `公司名称,比亚迪` |
| 第2行 | 报告日期 | 元数据，用于图表标题 | `报告日期,2024-12-31` |
| 第3行 | 表头 | 固定不变 | `资产类别,金额,类型` |
| 第4行+ | 数据行 | 具体的资产/负债项 | `现金,1432.85,资产` |

### 数据列说明

1. **资产类别**: 
   - 可以自定义名称
   - 常见项：现金、应收款、存货、固定资产等
   
2. **金额**: 
   - 数值类型
   - 支持小数
   - 单位自定义（亿、万等）

3. **类型**: 
   - 只能是 `资产` 或 `负债`
   - 决定柱子颜色（蓝色/红色）

---

## 🎨 图表说明

生成的图表包含：

- 🔵 **蓝色柱** - 资产项
- 🔴 **红色柱** - 负债项  
- 📊 **数值标签** - 柱子上方显示具体金额
- 📝 **标题** - 显示公司名称和报告日期
- 🏷️ **图例** - 区分资产和负债
- 📐 **网格线** - 便于读数

---

## 📁 项目文件结构

```
finance/
├── balance_sheet_plotter.py    # 核心模块（封装好的函数）⭐
├── quick_start.py              # 快速开始脚本 ⭐
├── example_usage.py            # 详细示例
├── data/
│   ├── 空白模板.csv             # 空白CSV模板 ⭐
│   ├── balance_sheet_template.csv  # 比亚迪示例
│   └── balance_sheet_data.csv      # 贵州茅台示例
├── output/                      # 生成的图表保存目录
├── README.md                    # 详细文档
└── 使用指南.md                  # 本文件

⭐ = 最常用的文件
```

---

## 🔧 常见问题 FAQ

### Q1: 如何修改图表尺寸？

```python
plot_balance_sheet_from_csv(
    'data/byd.csv',
    figsize=(20, 10)  # 宽20，高10
)
```

### Q2: 如何生成高清图表？

```python
plot_balance_sheet_from_csv(
    'data/byd.csv',
    dpi=600  # 600 DPI，适合印刷
)
```

### Q3: 如何批量处理不显示图表？

```python
plot_balance_sheet_from_csv(
    'data/byd.csv',
    show_plot=False  # 只保存，不显示
)
```

### Q4: CSV文件中文乱码怎么办？

确保CSV文件保存为 UTF-8 编码。

### Q5: 能否添加自定义的资产/负债项？

可以！直接在CSV中添加新行即可：
```csv
我的自定义项,12345.67,资产
```

### Q6: 金额单位是什么？

单位由你自己定义，系统只显示数字。建议在标题中注明单位（如"单位：亿元"）。

### Q7: 如何修改柱子颜色？

编辑 `balance_sheet_plotter.py` 文件，找到这行：
```python
colors = ['#4A90E2' if t == '资产' else '#E24A4A' for t in types]
```
修改颜色代码即可。

---

## 📝 完整示例

### 示例：分析比亚迪2024年报

```python
from balance_sheet_plotter import (
    plot_balance_sheet_from_csv,
    analyze_balance_sheet_from_csv
)

# 1. 数据分析
print("=" * 50)
print("数据分析")
print("=" * 50)
results = analyze_balance_sheet_from_csv('data/balance_sheet_template.csv')

# 2. 生成图表
print("\n" + "=" * 50)
print("生成图表")
print("=" * 50)
chart_path = plot_balance_sheet_from_csv(
    csv_path='data/balance_sheet_template.csv',
    output_path='output/比亚迪_资产负债表_2024.png',
    figsize=(18, 9),
    dpi=300,
    show_plot=True
)

print(f"\n✓ 完成！图表已保存至: {chart_path}")

# 3. 财务评估
if '资产负债率' in results:
    ratio = results['资产负债率']
    print(f"\n财务健康度: ", end="")
    if ratio < 40:
        print(f"优秀 (资产负债率: {ratio:.2f}%)")
    elif ratio < 60:
        print(f"良好 (资产负债率: {ratio:.2f}%)")
    elif ratio < 80:
        print(f"一般 (资产负债率: {ratio:.2f}%)")
    else:
        print(f"需关注 (资产负债率: {ratio:.2f}%)")
```

---

## ✨ 核心优势

1. ✅ **模板化** - CSV格式固定，只需填数字
2. ✅ **封装好** - 函数调用简单，一行代码搞定
3. ✅ **标准化** - 生成的图表格式统一、专业
4. ✅ **可扩展** - 轻松添加新的资产/负债项
5. ✅ **批量化** - 支持批量处理多个公司数据

---

## 🎯 快速命令参考

```bash
# 安装依赖
pip install pandas matplotlib numpy

# 快速生成图表
cd finance
python3 quick_start.py

# 运行示例
python3 example_usage.py

# 批量处理
# 准备好多个CSV文件，然后修改example_usage.py中的example4
```

---

## 📞 技巧提示

1. **建议工作流程**：
   ```
   复制空白模板 → 填入数据 → 运行quick_start.py
   ```

2. **数据准备技巧**：
   - 可以用Excel编辑，最后另存为CSV
   - 保持资产项在前，负债项在后（图表更美观）
   - 金额太大可以换算成亿或万为单位

3. **批量处理技巧**：
   - 准备多期数据：`byd_2023.csv`, `byd_2024.csv`
   - 准备多公司数据：`byd.csv`, `moutai.csv`, `tesla.csv`
   - 使用 `batch_plot_balance_sheets()` 一键生成所有图表

---

**版本**: v1.0  
**更新**: 2024-12-31

**祝你使用愉快！📊**

